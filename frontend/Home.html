<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>E-commerce Home</title>
    <style>
      body {
        margin: 0;
        padding-top: 0;
        font-family: Arial, sans-serif;
        background: url("https://images.unsplash.com/photo-1515162305284-61b5e72f0b84?auto=format&fit=crop&w=800&q=60")
          no-repeat center center fixed;
        background-size: cover;
        color: #333;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 10px 20px;
        color: white;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
      }

      nav {
        display: flex;
        gap: 20px;
      }

      nav a {
        color: white;
        text-decoration: none;
        font-weight: bold;
      }

      nav a:hover {
        text-decoration: underline;
      }

      header button {
        margin-right: 10px;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }

      header button:hover {
        background-color: #0056b3;
      }

      #hero {
        background: url("images/eco.jpg") no-repeat center center;
        background-size: cover;
        color: white;
        text-align: center;
        padding: 200px 30px 120px;
        margin-top: 60px;
      }

      #hero h1 {
        font-size: 3em;
        margin-bottom: 10px;
      }

      #hero p {
        font-size: 1.2em;
        max-width: 700px;
        margin: auto;
      }

      #productList {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 20px;
        justify-content: center;
      }

      .product {
        width: 220px;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 10px;
        text-align: center;
        background-color: #ffffffcc;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .product img {
        width: 100%;
        height: 140px;
        object-fit: cover;
        border-radius: 4px;
      }

      .price {
        font-weight: bold;
        color: #28a745;
        margin-top: 6px;
      }

      .controls {
        margin-top: 10px;
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
      }

      button.add-to-cart,
      button.control-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }

      button.add-to-cart {
        background-color: #28a745;
        color: white;
      }

      button.add-to-cart:hover {
        background-color: #218838;
      }

      button.control-btn {
        background-color: #007bff;
        color: white;
        min-width: 32px;
      }

      button.control-btn:hover {
        background-color: #0056b3;
      }

      button.remove-btn {
        background-color: #dc3545;
        color: white;
      }

      button.remove-btn:hover {
        background-color: #a71d2a;
      }

      .quantity-display {
        min-width: 20px;
        text-align: center;
        font-weight: bold;
      }

      #about,
      #contact {
        padding: 40px 20px;
        margin: 40px 20px;
        border-radius: 8px;
        color: white;
      }

      #about {
        background-color: #1873ce;
      }

      #contact {
        background-color: #9f3b3bcc;
      }

      footer {
        text-align: center;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px;
        margin-top: 40px;
      }

      footer a {
        color: #ccc;
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <header>
      <div>
        <button id="authBtn">Sign In</button>
      </div>
      <nav>
        <a href="#index">Home</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
        <a href="cart.html">Cart</a>
      </nav>
    </header>

    <section id="hero">
      <h1>Welcome to Our E-commerce Store</h1>
      <p>
        Discover amazing deals and high-quality products right at your
        fingertips. Shop from the comfort of your home and enjoy fast delivery,
        secure payments, and exceptional customer service.
      </p>
    </section>

    <h1 style="text-align: center">Product Listings</h1>
    <div id="productList">Loading products...</div>

    <section id="about">
      <h2>About Us</h2>
      <p>
        Welcome to our E-commerce store! We offer a wide selection of quality
        products at great prices. Our mission is to provide customers with a
        seamless shopping experience and excellent customer service.
      </p>
    </section>

    <section id="contact">
      <h2>Contact Us</h2>
      <p>
        Email:
        <a href="mailto:ZekariasWoreket@gmail.com">ZekariasWoreket@gmail.com</a>
      </p>
      <p>Phone: <a href="tel:+251984621422">+251-984-62-14-22</a></p>
      <p>Address: Addis Ababa, Ethiopia</p>

      <h3>Find us on social media:</h3>
      <p>
        <a href="https://www.linkedin.com/in/zekariasworeket" target="_blank"
          >üîó LinkedIn</a
        >
        |
        <a href="https://t.me/zekariasworeket" target="_blank">‚úàÔ∏è Telegram</a> |
        <a href="https://www.instagram.com/zekariasworeket" target="_blank"
          >üì∏ Instagram</a
        >
        |
        <a href="https://wa.me/251984621422" target="_blank">üí¨ WhatsApp</a>
      </p>
    </section>

    <footer>
      <p>&copy; 2025 E-commerce Store. All rights reserved.</p>
      <p><a href="#about">About</a> | <a href="#contact">Contact</a></p>
    </footer>

    <script>
      // üîê Session protection
      const userId = localStorage.getItem("userId");
      if (!userId) {
        alert("Please login to access this page.");
        window.location.href = "login.html";
      }

      const authBtn = document.getElementById("authBtn");
      const productList = document.getElementById("productList");

      function updateAuthBtn() {
        if (userId) {
          authBtn.textContent = "Logout";
        } else {
          authBtn.textContent = "Sign In";
        }
      }

      authBtn.onclick = () => {
        if (userId) {
          localStorage.removeItem("userId");
          alert("Logout successful.");
          window.location.href = "login.html";
        } else {
          window.location.href = "login.html";
        }
      };

      window.addEventListener("storage", (event) => {
        if (event.key === "userId") {
          updateAuthBtn();
        }
      });

      updateAuthBtn();

      function getCart() {
        return JSON.parse(localStorage.getItem("cart")) || [];
      }

      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      function renderProducts(products) {
        productList.innerHTML = "";

        if (!products || products.length === 0) {
          productList.innerHTML = "<p>No products found.</p>";
          return;
        }

        const cart = getCart();

        products.forEach((p) => {
          const div = document.createElement("div");
          div.className = "product";

          const imageUrl = p.image
            ? `https://simple-ecommerce-backend-6nvi.onrender.com//${p.image}`
            : "https://via.placeholder.com/220x140";

          const cartItem = cart.find((item) => item._id === p._id);
          const quantity = cartItem ? cartItem.quantity : 0;

          div.innerHTML = `
            <img src="${imageUrl}" alt="${p.name}" />
            <h3>${p.name}</h3>
            <p>${p.description}</p>
            <div class="price">${p.price.toFixed(2)} Birr</div>
          `;

          const controlsDiv = document.createElement("div");
          controlsDiv.className = "controls";

          if (quantity === 0) {
            const addBtn = document.createElement("button");
            addBtn.textContent = "Add to Cart";
            addBtn.className = "add-to-cart";
            addBtn.onclick = () => {
              addToCart(p);
              renderProducts(products);
            };
            controlsDiv.appendChild(addBtn);
          } else {
            const minusBtn = document.createElement("button");
            minusBtn.textContent = "-";
            minusBtn.className = "control-btn";
            minusBtn.onclick = () => {
              decreaseQuantity(p);
              renderProducts(products);
            };

            const qtySpan = document.createElement("span");
            qtySpan.textContent = quantity;
            qtySpan.className = "quantity-display";

            const plusBtn = document.createElement("button");
            plusBtn.textContent = "+";
            plusBtn.className = "control-btn";
            plusBtn.onclick = () => {
              increaseQuantity(p);
              renderProducts(products);
            };

            const removeBtn = document.createElement("button");
            removeBtn.textContent = "Remove";
            removeBtn.className = "remove-btn";
            removeBtn.onclick = () => {
              removeFromCart(p);
              renderProducts(products);
            };

            controlsDiv.append(minusBtn, qtySpan, plusBtn, removeBtn);
          }

          div.appendChild(controlsDiv);
          productList.appendChild(div);
        });
      }

      function addToCart(product) {
        let cart = getCart();
        const index = cart.findIndex((item) => item._id === product._id);
        if (index >= 0) {
          cart[index].quantity += 1;
        } else {
          cart.push({ ...product, quantity: 1 });
        }
        saveCart(cart);
        alert(`${product.name} added to cart!`);
      }

      function increaseQuantity(product) {
        let cart = getCart();
        const index = cart.findIndex((item) => item._id === product._id);
        if (index >= 0) {
          cart[index].quantity += 1;
          saveCart(cart);
        }
      }

      function decreaseQuantity(product) {
        let cart = getCart();
        const index = cart.findIndex((item) => item._id === product._id);
        if (index >= 0) {
          if (cart[index].quantity > 1) {
            cart[index].quantity -= 1;
          } else {
            cart.splice(index, 1);
          }
          saveCart(cart);
        }
      }

      function removeFromCart(product) {
        let cart = getCart();
        cart = cart.filter((item) => item._id !== product._id);
        saveCart(cart);
      }

      function loadProducts() {
        fetch(
          "https://simple-ecommerce-backend-6nvi.onrender.com//api/products/get-product"
        )
          .then((res) => res.json())
          .then((products) => {
            renderProducts(products);
          })
          .catch((err) => {
            productList.innerHTML =
              '<p style="color:red;">Failed to load products: ' +
              err.message +
              "</p>";
          });
      }

      loadProducts();
    </script>
  </body>
</html>
